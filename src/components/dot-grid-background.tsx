
"use client";

import React, { useRef, useEffect, useState } from 'react';
import { useTheme } from 'next-themes';

const bullPathString = "M214.7,204.8c-1.3-0.1-2.6-0.3-3.9-0.5c-6.2-1.1-12.3-2.3-17.7-5.3c-2.3-1.3-4-3.4-6.3-4.8c-0.4-0.3-0.8-0.5-1.2-0.8c-4.4-2.8-8.2-6-12.7-8.3c-2.9-1.5-6-2.5-9-3.8c-2.2-0.9-4.3-1.9-6.4-3c-1.7-0.9-3.3-1.8-5-2.7c-5-2.8-9.8-5.8-14.7-8.6c-1.2-0.7-2.3-1.4-3.5-2.1c-1.9-1.1-3.8-2.2-5.6-3.4c-3-2-5.9-4.1-8.7-6.4c-2.1-1.7-4-3.6-5.8-5.5c-2.7-2.8-5-5.9-7-9.1c-1.2-1.8-2.2-3.8-3-5.8c-1.3-3-2.1-6.2-2.3-9.4c-0.2-2-0.2-4.1-0.2-6.1c0-0.9,0.1-1.8,0.2-2.7c0.2-1.3,0.5-2.6,0.8-3.9c0.7-2.4,1.6-4.7,2.7-6.9c0.7-1.4,1.5-2.8,2.2-4.2c1.2-2.2,2.4-4.3,3.8-6.4c0.1-0.2,0.2-0.3,0.4-0.5c1.4-2.1,3-4,4.7-5.9c0.9-1,1.8-1.9,2.7-2.9c0.5-0.5,1-1,1.5-1.5c1.1-1.2,2.2-2.4,3.3-3.5c1-1,2-2,3-3c0.4-0.4,0.7-0.7,1.1-1.1c0.7-0.7,1.4-1.3,2.1-2c0.7-0.6,1.4-1.2,2.1-1.8c0.2-0.2,0.5-0.4,0.7-0.6c0.8-0.6,1.5-1.2,2.3-1.7c0.6-0.4,1.1-0.8,1.7-1.2c2.1-1.5,4.3-2.8,6.5-4.1c1.5-0.9,3-1.8,4.5-2.6c0.9-0.5,1.8-1,2.7-1.4c1.6-0.8,3.2-1.5,4.8-2.2c0.8-0.3,1.6-0.7,2.4-1c0.2-0.1,0.5-0.2,0.7-0.3c3.5-1.4,7-2.7,10.6-3.7c1-0.3,2-0.5,3-0.8c2.1-0.6,4.2-1.1,6.3-1.6c1.1-0.2,2.1-0.5,3.2-0.7c1.3-0.2,2.5-0.5,3.8-0.6c1.2-0.1,2.5-0.2,3.7-0.3c2.3-0.1,4.6-0.1,6.9,0c1.2,0,2.5,0.1,3.7,0.2c2.4,0.2,4.8,0.6,7.1,1.1c1.3,0.3,2.6,0.6,3.9,0.9c2.7,0.7,5.4,1.5,8,2.4c1.1,0.4,2.2,0.8,3.3,1.2c1,0.4,2.1,0.8,3.1,1.2c2.2,0.9,4.4,1.9,6.5,3c1.2,0.6,2.4,1.2,3.6,1.9c1,0.6,2,1.2,2.9,1.8c0.8,0.5,1.6,1,2.4,1.5c0.5,0.3,1,0.7,1.5,1c1.8,1.2,3.5,2.4,5.2,3.7c0.8,0.6,1.6,1.2,2.4,1.8c0.3,0.3,0.7,0.5,1,0.8c1.7,1.3,3.3,2.7,4.9,4.1c0.9,0.8,1.7,1.6,2.5,2.4c1,1.1,1.9,2.2,2.8,3.3c0.7,0.9,1.4,1.8,2.1,2.7c0.8,1.1,1.6,2.2,2.3,3.4c0.9,1.4,1.8,2.8,2.5,4.3c0.8,1.5,1.5,3.1,2.1,4.7c0.5,1.2,0.9,2.5,1.2,3.7c0.2,0.9,0.4,1.8,0.5,2.7c0.3,1.8,0.4,3.7,0.4,5.5c0,1.4-0.1,2.8-0.3,4.2c-0.2,1.8-0.6,3.6-1.1,5.3c-0.7,2.2-1.6,4.4-2.7,6.4c-0.7,1.3-1.5,2.5-2.3,3.7c-2,3-4.3,5.8-6.9,8.3c-1.4,1.4-2.9,2.7-4.4,3.9c-1.4,1.1-2.8,2.1-4.2,3.1c-2.9,2-5.9,3.9-8.9,5.5c-2.3,1.3-4.6,2.4-7,3.4c-2.2,0.9-4.4,1.6-6.6,2.3c-1.1,0.3-2.1,0.6-3.2,0.9c-2.7,0.7-5.4,1.3-8.1,1.8c-1.2,0.2-2.3,0.4-3.5,0.5c-0.8,0.1-1.6,0.2-2.4,0.3c-1.9,0.2-3.8,0.3-5.7,0.3C216.9,204.8,215.8,204.8,214.7,204.8z M186.2,191.1c1.2-0.5,2.3-1,3.5-1.5c1-0.4,2-0.8,3-1.2c1.9-0.8,3.8-1.6,5.6-2.5c0.9-0.4,1.7-0.9,2.6-1.3c0.4-0.2,0.8-0.4,1.2-0.6c0.9-0.5,1.8-1,2.7-1.5c1.2-0.7,2.4-1.4,3.6-2.1c0.1,0,0.1-0.1,0.2-0.1c-0.2,0.3-0.4,0.5-0.6,0.8c-1.1,1.3-2.2,2.5-3.4,3.7c-1.3,1.4-2.7,2.7-4.1,3.9c-0.8,0.7-1.6,1.3-2.4,2c-1.5,1.2-3,2.4-4.6,3.5c-1.3,0.9-2.6,1.7-4,2.5c-0.7,0.4-1.4,0.8-2.1,1.2c-1.5,0.8-3,1.6-4.5,2.3c-0.7,0.3-1.4,0.6-2.1,0.9c-1.6,0.7-3.2,1.3-4.8,1.9c-0.7,0.2-1.3,0.5-2,0.7c-1,0.3-2,0.6-3,0.9c-1.3,0.4-2.6,0.7-3.9,1c-1.1,0.3-2.3,0.5-3.4,0.7c-0.9,0.2-1.8,0.3-2.7,0.4c-1.1,0.1-2.2,0.2-3.3,0.2c-0.6,0-1.2,0-1.8-0.1c1.1-0.1,2.2-0.2,3.3-0.4c1.3-0.2,2.5-0.4,3.8-0.7c1-0.2,2-0.5,3-0.7c0.8-0.2,1.7-0.4,2.5-0.7c1.1-0.3,2.2-0.7,3.3-1.1c1-0.3,2-0.7,3-1.1c0.9-0.3,1.8-0.7,2.7-1c0.9-0.3,1.8-0.7,2.7-1.1c1.3-0.5,2.6-1.1,3.8-1.7C184.4,192.2,185.3,191.7,186.2,191.1z M125.1,114.5c-0.6-1.1-1.1-2.2-1.6-3.3c-0.9-2-1.7-4-2.3-6c-0.2-0.7-0.4-1.4-0.6-2.1c-0.3-1.3-0.5-2.6-0.6-3.9c-0.1-0.7-0.1-1.4-0.1-2.1c0-0.4,0-0.8,0.1-1.2c0.1-1.3,0.3-2.6,0.6-3.8c0.5-2,1.1-3.9,1.9-5.8c0.5-1.2,1-2.3,1.6-3.5c0.9-1.8,1.9-3.6,3-5.3c0.2-0.3,0.3-0.5,0.5-0.8c0.8-1.4,1.7-2.8,2.6-4.1c0.1-0.2,0.3-0.4,0.4-0.6c0.9-1.2,1.8-2.4,2.7-3.5c1.4-1.7,2.8-3.3,4.3-4.9c0.2-0.2,0.4-0.4,0.6-0.7c1.4-1.5,2.8-3,4.3-4.4c0.5-0.5,1-1,1.6-1.5c1-1,2-1.9,3-2.9c0.5-0.5,1-1,1.5-1.5c0.6-0.6,1.2-1.2,1.8-1.7c1-1,2.1-1.9,3.2-2.8c1-0.8,2-1.6,3.1-2.4c0.6-0.5,1.2-0.9,1.8-1.4c1.1-0.8,2.2-1.6,3.4-2.4c0.9-0.6,1.8-1.2,2.7-1.7c1.8-1.1,3.6-2.1,5.5-3.1c0.7-0.4,1.4-0.7,2.1-1.1c1.1-0.6,2.2-1.2,3.3-1.8c1.3-0.7,2.6-1.3,3.9-1.9c1.2-0.6,2.4-1.1,3.7-1.6c0.6-0.2,1.2-0.5,1.8-0.7c1.3-0.4,2.6-0.8,3.9-1.2c1-0.3,2-0.6,3-0.8c1.3-0.3,2.6-0.6,3.9-0.8c1.2-0.2,2.4-0.4,3.6-0.5c0.5-0.1,1.1-0.1,1.6-0.1c0.1,0,0.2,0,0.3,0c0.1-0.1,0.2-0.2,0.3-0.3c0.1-0.1,0.2-0.2,0.3-0.3c-0.1,0-0.2,0-0.3,0c-0.5,0-1,0.1-1.6,0.1c-1.2,0.1-2.4,0.2-3.6,0.4c-1.3,0.2-2.6,0.5-3.9,0.7c-1,0.2-2,0.4-3,0.7c-1.3,0.3-2.6,0.7-3.9,1.1c-0.6,0.2-1.2,0.4-1.8,0.6c-1.3,0.4-2.6,0.9-3.8,1.4c-1.2,0.5-2.4,1-3.6,1.5c-1.3,0.6-2.5,1.3-3.8,1.9c-1.1,0.6-2.2,1.2-3.3,1.8c-0.7,0.4-1.4,0.8-2.1,1.2c-1.9,1-3.7,2.1-5.5,3.2c-0.9,0.5-1.8,1.1-2.7,1.7c-1.1,0.8-2.2,1.6-3.3,2.4c-0.6,0.5-1.2,1-1.8,1.5c-1,0.8-2,1.7-3,2.6c-0.6,0.6-1.2,1.2-1.8,1.8c-0.5,0.5-1,1-1.5,1.5c-1,1-2,2-3,3c-0.5,0.5-1,1-1.5,1.6c-1.5,1.5-2.9,3-4.3,4.6c-0.2,0.2-0.4,0.5-0.6,0.7c-1.5,1.6-2.9,3.3-4.2,5c-0.9,1.1-1.8,2.3-2.7,3.5c-0.1,0.2-0.3,0.4-0.4,0.6c-0.9,1.3-1.8,2.7-2.6,4.1c-0.2,0.3-0.3,0.5-0.5,0.8c-0.8,1.7-1.5,3.4-2.1,5.2c-0.5,1.2-1,2.5-1.5,3.7c-0.6,1.9-1.1,3.8-1.5,5.7c-0.3,1.3-0.5,2.6-0.6,3.9c-0.1,0.7-0.1,1.4-0.1,2.1c0,0.4,0,0.8,0.1,1.2c0.1,1.3,0.3,2.6,0.6,3.9c0.2,0.7,0.4,1.4,0.6,2.1C123.4,110.5,124.2,112.5,125.1,114.5z M107.1,72.2c0.2,0,0.4,0,0.6,0c0.1,0,0.1,0,0.2,0c0.1,0,0.2,0,0.3,0c0.1,0,0.1,0,0.2,0c-0.1,0-0.2,0-0.3,0c-0.1,0-0.1,0-0.2,0c-0.1,0-0.2,0-0.3,0C107.5,72.2,107.3,72.2,107.1,72.2z M106.8,70.1c0.1,0,0.2,0,0.3,0c0.1,0,0.1,0,0.2,0c-0.1,0-0.2,0-0.3,0C106.9,70.1,106.9,70.1,106.8,70.1z M287.4,124.7c1,0,2-0.1,3-0.2c0.8-0.1,1.7-0.2,2.5-0.4c0.8-0.2,1.6-0.4,2.4-0.6c0.8-0.2,1.5-0.5,2.3-0.7c0.6-0.2,1.2-0.4,1.8-0.6c0.9-0.3,1.7-0.7,2.6-1c0.7-0.3,1.5-0.6,2.2-0.9c0.6-0.2,1.2-0.5,1.8-0.8c0.7-0.3,1.5-0.6,2.2-1c0.8-0.4,1.6-0.8,2.4-1.2c0.4-0.2,0.8-0.4,1.2-0.6c0.7-0.4,1.4-0.7,2.1-1.1c0.5-0.3,1-0.5,1.5-0.8c0.8-0.5,1.6-1,2.4-1.5c0.6-0.4,1.2-0.8,1.8-1.2c1.2-0.9,2.4-1.8,3.5-2.7c1-0.9,2-1.8,2.9-2.7c1-1,1.9-2.1,2.8-3.1c1.2-1.4,2.3-2.9,3.3-4.4c0.7-1,1.3-2,1.9-3.1c0.7-1.2,1.4-2.5,2-3.7c0.5-1,1-2.1,1.4-3.1c0.2-0.5,0.4-1,0.6-1.5c0.4-1,0.7-2,1-3c0.1-0.2,0.1-0.5,0.2-0.7c0.2-0.8,0.4-1.5,0.6-2.3c0.1-0.4,0.2-0.9,0.3-1.3c0.2-0.8,0.3-1.6,0.4-2.4c0.1-0.5,0.1-1.1,0.1-1.6c0-0.2,0-0.4-0.1-0.6c-0.1-0.8-0.2-1.6-0.4-2.4c-0.1-0.4-0.2-0.9-0.3-1.3c-0.2-0.8-0.4-1.5-0.6-2.3c-0.1-0.2-0.1-0.5-0.2-0.7c-0.3-1-0.6-2-1-3c-0.2-0.5-0.4-1-0.6-1.5c-0.4-1-0.9-2.1-1.4-3.1c-0.6-1.1-1.2-2.1-1.9-3.1c-1-1.5-2.1-2.9-3.3-4.4c-0.9-1.1-1.8-2.1-2.8-3.1c-1-1-2-1.9-2.9-2.7c-1.1-0.9-2.3-1.8-3.5-2.7c-0.6-0.4-1.2-0.8-1.8-1.2c-0.8-0.5-1.6-1-2.4-1.5c-0.5-0.3-1-0.5-1.5-0.8c-0.7-0.4-1.4-0.7-2.1-1.1c-0.4-0.2-0.8-0.4-1.2-0.6c-0.8-0.4-1.6-0.8-2.4-1.2c-0.7-0.4-1.5-0.7-2.2-1c-0.6-0.3-1.2-0.5-1.8-0.8c-0.7-0.3-1.5-0.7-2.2-1c-0.9-0.4-1.7-0.7-2.6-1c-0.6-0.2-1.2-0.4-1.8-0.6c-0.8-0.3-1.5-0.5-2.3-0.7c-0.8-0.2-1.6-0.4-2.4-0.6c-0.8-0.2-1.7-0.3-2.5-0.4c-1-0.1-2-0.2-3-0.2c-0.1,0-0.3,0-0.4,0c0,0.1,0,0.2,0,0.3c0,0.1,0,0.2,0,0.3c0.1,0,0.3,0,0.4,0C285.4,124.8,286.4,124.8,287.4,124.7z";

const DotGridBackground = () => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const { theme } = useTheme();
  const [bullPath, setBullPath] = useState<Path2D | null>(null);

  useEffect(() => {
    // This code runs only on the client, after the component mounts.
    // This is the correct place to use browser-only APIs like Path2D.
    setBullPath(new Path2D(bullPathString));
  }, []);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas || !bullPath) return; // Don't run if canvas or path isn't ready
    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    let mouse = { x: -1000, y: -1000 };
    let animationFrameId: number;

    const resizeCanvas = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };
    
    const handleMouseMove = (e: MouseEvent) => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
    };

    const draw = () => {
      if(!ctx) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const spacing = 35;
      const dotSize = 1.2;
      const mouseRadius = 150;

      const lightThemeColors = {
        glow: 'hsla(217, 91%, 60%,', // primary
        dot: 'hsla(220, 20%, 88%, 0.5)', // border
      };
      const darkThemeColors = {
        glow: 'hsla(90, 100%, 50%,', // primary
        dot: 'hsla(159, 100%, 22%, 0.4)', // accent
      };

      const colors = theme === 'light' ? lightThemeColors : darkThemeColors;

      for (let x = 0; x < canvas.width; x += spacing) {
        for (let y = 0; y < canvas.height; y += spacing) {
          const dx = mouse.x - x;
          const dy = mouse.y - y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          
          if (dist < mouseRadius) {
            // Skip drawing dots inside the radius to make space for the bull
            continue;
          }
            
          ctx.fillStyle = colors.dot;
          ctx.beginPath();
          ctx.arc(x, y, dotSize, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      // Draw the bull at the mouse position
      if (mouse.x > -1000) {
        ctx.save();
        ctx.translate(mouse.x - 110, mouse.y - 110); // Center the bull on the cursor
        ctx.scale(0.5, 0.5); // Scale the bull down
        ctx.fillStyle = `${colors.glow} 0.8)`;
        ctx.shadowColor = `${colors.glow} 1)`;
        ctx.shadowBlur = 15;
        ctx.fill(bullPath);
        ctx.restore();
      }

      animationFrameId = requestAnimationFrame(draw);
    };

    // Run on client mount
    resizeCanvas();
    draw();

    window.addEventListener('resize', resizeCanvas);
    document.body.addEventListener('mousemove', handleMouseMove);

    return () => {
      cancelAnimationFrame(animationFrameId);
      window.removeEventListener('resize', resizeCanvas);
      document.body.removeEventListener('mousemove', handleMouseMove);
    };
  }, [theme, bullPath]);

  return (
    <div className="fixed top-0 left-0 w-full h-full -z-10">
      <canvas ref={canvasRef}/>
    </div>
  );
};

export default DotGridBackground;
